{"ast":null,"code":"'use strict';\n\nvar _classCallCheck = require(\"C:\\\\Users\\\\vothb\\\\Desktop\\\\School\\\\Quarter_5\\\\CIS259\\\\Plankcooking-microservices\\\\Plankcooking\\\\client\\\\node_modules\\\\babel-preset-react-app\\\\node_modules\\\\@babel\\\\runtime/helpers/classCallCheck\");\n\nvar _createClass = require(\"C:\\\\Users\\\\vothb\\\\Desktop\\\\School\\\\Quarter_5\\\\CIS259\\\\Plankcooking-microservices\\\\Plankcooking\\\\client\\\\node_modules\\\\babel-preset-react-app\\\\node_modules\\\\@babel\\\\runtime/helpers/createClass\");\n\nvar _possibleConstructorReturn = require(\"C:\\\\Users\\\\vothb\\\\Desktop\\\\School\\\\Quarter_5\\\\CIS259\\\\Plankcooking-microservices\\\\Plankcooking\\\\client\\\\node_modules\\\\babel-preset-react-app\\\\node_modules\\\\@babel\\\\runtime/helpers/possibleConstructorReturn\");\n\nvar _get = require(\"C:\\\\Users\\\\vothb\\\\Desktop\\\\School\\\\Quarter_5\\\\CIS259\\\\Plankcooking-microservices\\\\Plankcooking\\\\client\\\\node_modules\\\\babel-preset-react-app\\\\node_modules\\\\@babel\\\\runtime/helpers/get\");\n\nvar _getPrototypeOf = require(\"C:\\\\Users\\\\vothb\\\\Desktop\\\\School\\\\Quarter_5\\\\CIS259\\\\Plankcooking-microservices\\\\Plankcooking\\\\client\\\\node_modules\\\\babel-preset-react-app\\\\node_modules\\\\@babel\\\\runtime/helpers/getPrototypeOf\");\n\nvar _inherits = require(\"C:\\\\Users\\\\vothb\\\\Desktop\\\\School\\\\Quarter_5\\\\CIS259\\\\Plankcooking-microservices\\\\Plankcooking\\\\client\\\\node_modules\\\\babel-preset-react-app\\\\node_modules\\\\@babel\\\\runtime/helpers/inherits\");\n\nvar debug = require('debug')('mssql:tedi');\n\nvar BaseTransaction = require('../base/transaction');\n\nvar _require = require('../utils'),\n    IDS = _require.IDS;\n\nvar TransactionError = require('../error/transaction-error');\n\nvar Transaction = /*#__PURE__*/function (_BaseTransaction) {\n  _inherits(Transaction, _BaseTransaction);\n\n  function Transaction(parent) {\n    var _this;\n\n    _classCallCheck(this, Transaction);\n\n    _this = _possibleConstructorReturn(this, _getPrototypeOf(Transaction).call(this, parent));\n\n    _this._abort = function () {\n      if (!_this._rollbackRequested) {\n        // transaction interrupted because of XACT_ABORT\n        var pc = _this._acquiredConnection; // defer releasing so connection can switch from SentClientRequest to LoggedIn state\n\n        setImmediate(_this.parent.release.bind(_this.parent), pc);\n\n        _this._acquiredConnection.removeListener('rollbackTransaction', _this._abort);\n\n        _this._acquiredConnection = null;\n        _this._acquiredConfig = null;\n        _this._aborted = true;\n\n        _this.emit('rollback', true);\n      }\n    };\n\n    return _this;\n  }\n\n  _createClass(Transaction, [{\n    key: \"_begin\",\n    value: function _begin(isolationLevel, callback) {\n      var _this2 = this;\n\n      _get(_getPrototypeOf(Transaction.prototype), \"_begin\", this).call(this, isolationLevel, function (err) {\n        if (err) return callback(err);\n        debug('transaction(%d): begin', IDS.get(_this2));\n\n        _this2.parent.acquire(_this2, function (err, connection, config) {\n          if (err) return callback(err);\n          _this2._acquiredConnection = connection;\n\n          _this2._acquiredConnection.on('rollbackTransaction', _this2._abort);\n\n          _this2._acquiredConfig = config;\n          connection.beginTransaction(function (err) {\n            if (err) err = new TransactionError(err);\n            debug('transaction(%d): begun', IDS.get(_this2));\n            callback(err);\n          }, _this2.name, _this2.isolationLevel);\n        });\n      });\n    }\n  }, {\n    key: \"_commit\",\n    value: function _commit(callback) {\n      var _this3 = this;\n\n      _get(_getPrototypeOf(Transaction.prototype), \"_commit\", this).call(this, function (err) {\n        if (err) return callback(err);\n        debug('transaction(%d): commit', IDS.get(_this3));\n\n        _this3._acquiredConnection.commitTransaction(function (err) {\n          if (err) err = new TransactionError(err);\n\n          _this3._acquiredConnection.removeListener('rollbackTransaction', _this3._abort);\n\n          _this3.parent.release(_this3._acquiredConnection);\n\n          _this3._acquiredConnection = null;\n          _this3._acquiredConfig = null;\n          if (!err) debug('transaction(%d): commited', IDS.get(_this3));\n          callback(err);\n        });\n      });\n    }\n  }, {\n    key: \"_rollback\",\n    value: function _rollback(callback) {\n      var _this4 = this;\n\n      _get(_getPrototypeOf(Transaction.prototype), \"_rollback\", this).call(this, function (err) {\n        if (err) return callback(err);\n        debug('transaction(%d): rollback', IDS.get(_this4));\n\n        _this4._acquiredConnection.rollbackTransaction(function (err) {\n          if (err) err = new TransactionError(err);\n\n          _this4._acquiredConnection.removeListener('rollbackTransaction', _this4._abort);\n\n          _this4.parent.release(_this4._acquiredConnection);\n\n          _this4._acquiredConnection = null;\n          _this4._acquiredConfig = null;\n          if (!err) debug('transaction(%d): rolled back', IDS.get(_this4));\n          callback(err);\n        });\n      });\n    }\n  }]);\n\n  return Transaction;\n}(BaseTransaction);\n\nmodule.exports = Transaction;","map":null,"metadata":{},"sourceType":"script"}