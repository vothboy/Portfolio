{"ast":null,"code":"\"use strict\";\n\nvar _classCallCheck = require(\"C:\\\\Users\\\\vothb\\\\Desktop\\\\School\\\\Quarter_5\\\\CIS259\\\\Plankcooking-microservices\\\\Plankcooking\\\\client\\\\node_modules\\\\babel-preset-react-app\\\\node_modules\\\\@babel\\\\runtime/helpers/classCallCheck\");\n\nvar _createClass = require(\"C:\\\\Users\\\\vothb\\\\Desktop\\\\School\\\\Quarter_5\\\\CIS259\\\\Plankcooking-microservices\\\\Plankcooking\\\\client\\\\node_modules\\\\babel-preset-react-app\\\\node_modules\\\\@babel\\\\runtime/helpers/createClass\");\n\nvar _possibleConstructorReturn = require(\"C:\\\\Users\\\\vothb\\\\Desktop\\\\School\\\\Quarter_5\\\\CIS259\\\\Plankcooking-microservices\\\\Plankcooking\\\\client\\\\node_modules\\\\babel-preset-react-app\\\\node_modules\\\\@babel\\\\runtime/helpers/possibleConstructorReturn\");\n\nvar _getPrototypeOf = require(\"C:\\\\Users\\\\vothb\\\\Desktop\\\\School\\\\Quarter_5\\\\CIS259\\\\Plankcooking-microservices\\\\Plankcooking\\\\client\\\\node_modules\\\\babel-preset-react-app\\\\node_modules\\\\@babel\\\\runtime/helpers/getPrototypeOf\");\n\nvar _inherits = require(\"C:\\\\Users\\\\vothb\\\\Desktop\\\\School\\\\Quarter_5\\\\CIS259\\\\Plankcooking-microservices\\\\Plankcooking\\\\client\\\\node_modules\\\\babel-preset-react-app\\\\node_modules\\\\@babel\\\\runtime/helpers/inherits\");\n\nObject.defineProperty(exports, \"__esModule\", {\n  value: true\n});\nexports.default = void 0;\n\nvar _bl = _interopRequireDefault(require(\"bl\"));\n\nvar _readableStream = require(\"readable-stream\");\n\nvar _packet = require(\"./packet\");\n\nfunction _interopRequireDefault(obj) {\n  return obj && obj.__esModule ? obj : {\n    default: obj\n  };\n}\n\nvar OutgoingMessageStream = /*#__PURE__*/function (_readableStream$Duple) {\n  _inherits(OutgoingMessageStream, _readableStream$Duple);\n\n  function OutgoingMessageStream(debug, _ref) {\n    var _this;\n\n    var packetSize = _ref.packetSize;\n\n    _classCallCheck(this, OutgoingMessageStream);\n\n    _this = _possibleConstructorReturn(this, _getPrototypeOf(OutgoingMessageStream).call(this, {\n      writableObjectMode: true\n    }));\n    _this.packetSize = void 0;\n    _this.debug = void 0;\n    _this.bl = void 0;\n    _this.currentMessage = void 0;\n    _this.packetSize = packetSize;\n    _this.debug = debug;\n    _this.bl = new _bl.default(); // When the writable side is ended, push `null`\n    // to also end the readable side.\n\n    _this.on('finish', function () {\n      _this.push(null);\n    });\n\n    return _this;\n  }\n\n  _createClass(OutgoingMessageStream, [{\n    key: \"_write\",\n    value: function _write(message, _encoding, callback) {\n      var _this2 = this;\n\n      var length = this.packetSize - _packet.HEADER_LENGTH;\n      var packetNumber = 0;\n      this.currentMessage = message;\n      this.currentMessage.on('data', function (data) {\n        if (message.ignore) {\n          return;\n        }\n\n        _this2.bl.append(data);\n\n        while (_this2.bl.length > length) {\n          var _data = _this2.bl.slice(0, length);\n\n          _this2.bl.consume(length); // TODO: Get rid of creating `Packet` instances here.\n\n\n          var packet = new _packet.Packet(message.type);\n          packet.packetId(packetNumber += 1);\n          packet.resetConnection(message.resetConnection);\n          packet.addData(_data);\n\n          _this2.debug.packet('Sent', packet);\n\n          _this2.debug.data(packet);\n\n          if (_this2.push(packet.buffer) === false) {\n            message.pause();\n          }\n        }\n      });\n      this.currentMessage.on('end', function () {\n        var data = _this2.bl.slice();\n\n        _this2.bl.consume(data.length); // TODO: Get rid of creating `Packet` instances here.\n\n\n        var packet = new _packet.Packet(message.type);\n        packet.packetId(packetNumber += 1);\n        packet.resetConnection(message.resetConnection);\n        packet.last(true);\n        packet.ignore(message.ignore);\n        packet.addData(data);\n\n        _this2.debug.packet('Sent', packet);\n\n        _this2.debug.data(packet);\n\n        _this2.push(packet.buffer);\n\n        _this2.currentMessage = undefined;\n        callback();\n      });\n    }\n  }, {\n    key: \"_read\",\n    value: function _read(_size) {\n      // If we do have a message, resume it and get data flowing.\n      // Otherwise, there is nothing to do.\n      if (this.currentMessage) {\n        this.currentMessage.resume();\n      }\n    }\n  }]);\n\n  return OutgoingMessageStream;\n}(_readableStream.Duplex);\n\nvar _default = OutgoingMessageStream;\nexports.default = _default;\nmodule.exports = OutgoingMessageStream;","map":null,"metadata":{},"sourceType":"script"}