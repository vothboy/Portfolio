{"ast":null,"code":"\"use strict\";\n\nObject.defineProperty(exports, \"__esModule\", {\n  value: true\n});\nexports.default = void 0;\n\nvar _token = require(\"./token\");\n\nvar _valueParser = _interopRequireDefault(require(\"../value-parser\"));\n\nfunction _interopRequireDefault(obj) {\n  return obj && obj.__esModule ? obj : {\n    default: obj\n  };\n} // s2.2.7.13 (introduced in TDS 7.3.B)\n\n\nfunction nullHandler(_parser, _columnMetadata, _options, callback) {\n  callback(null);\n}\n\nfunction nbcRowParser(parser, columnsMetaData, options, callback) {\n  var length = Math.ceil(columnsMetaData.length / 8);\n  parser.readBuffer(length, function (bytes) {\n    var bitmap = [];\n\n    for (var _i = 0, _len = bytes.length; _i < _len; _i++) {\n      var byte = bytes[_i];\n\n      for (var j = 0; j <= 7; j++) {\n        bitmap.push(byte & 1 << j ? true : false);\n      }\n    }\n\n    var columns = [];\n    var len = columnsMetaData.length;\n    var i = 0;\n\n    function next(done) {\n      if (i === len) {\n        return done();\n      }\n\n      var columnMetaData = columnsMetaData[i];\n      (bitmap[i] ? nullHandler : _valueParser.default)(parser, columnMetaData, options, function (value) {\n        columns.push({\n          value: value,\n          metadata: columnMetaData\n        });\n        i++;\n        next(done);\n      });\n    }\n\n    next(function () {\n      if (options.useColumnNames) {\n        var columnsMap = {};\n        columns.forEach(function (column) {\n          var colName = column.metadata.colName;\n\n          if (columnsMap[colName] == null) {\n            columnsMap[colName] = column;\n          }\n        });\n        callback(new _token.NBCRowToken(columnsMap));\n      } else {\n        callback(new _token.NBCRowToken(columns));\n      }\n    });\n  });\n}\n\nvar _default = nbcRowParser;\nexports.default = _default;\nmodule.exports = nbcRowParser;","map":null,"metadata":{},"sourceType":"script"}