{"ast":null,"code":"\"use strict\";\n\nObject.defineProperty(exports, \"__esModule\", {\n  value: true\n});\nexports.default = void 0;\n\nvar _metadataParser = _interopRequireDefault(require(\"../metadata-parser\"));\n\nvar _token = require(\"./token\");\n\nfunction _interopRequireDefault(obj) {\n  return obj && obj.__esModule ? obj : {\n    default: obj\n  };\n}\n\nfunction readTableName(parser, options, metadata, callback) {\n  if (metadata.type.hasTableName) {\n    if (options.tdsVersion >= '7_2') {\n      parser.readUInt8(function (numberOfTableNameParts) {\n        var tableName = [];\n        var i = 0;\n\n        function next(done) {\n          if (numberOfTableNameParts === i) {\n            return done();\n          }\n\n          parser.readUsVarChar(function (part) {\n            tableName.push(part);\n            i++;\n            next(done);\n          });\n        }\n\n        next(function () {\n          callback(tableName);\n        });\n      });\n    } else {\n      parser.readUsVarChar(callback);\n    }\n  } else {\n    callback(undefined);\n  }\n}\n\nfunction readColumnName(parser, options, index, metadata, callback) {\n  parser.readBVarChar(function (colName) {\n    if (options.columnNameReplacer) {\n      callback(options.columnNameReplacer(colName, index, metadata));\n    } else if (options.camelCaseColumns) {\n      callback(colName.replace(/^[A-Z]/, function (s) {\n        return s.toLowerCase();\n      }));\n    } else {\n      callback(colName);\n    }\n  });\n}\n\nfunction readColumn(parser, options, index, callback) {\n  (0, _metadataParser.default)(parser, options, function (metadata) {\n    readTableName(parser, options, metadata, function (tableName) {\n      readColumnName(parser, options, index, metadata, function (colName) {\n        callback({\n          userType: metadata.userType,\n          flags: metadata.flags,\n          type: metadata.type,\n          collation: metadata.collation,\n          precision: metadata.precision,\n          scale: metadata.scale,\n          udtInfo: metadata.udtInfo,\n          dataLength: metadata.dataLength,\n          schema: metadata.schema,\n          colName: colName,\n          tableName: tableName\n        });\n      });\n    });\n  });\n}\n\nfunction colMetadataParser(parser, _colMetadata, options, callback) {\n  parser.readUInt16LE(function (columnCount) {\n    var columns = [];\n    var i = 0;\n\n    function next(done) {\n      if (i === columnCount) {\n        return done();\n      }\n\n      readColumn(parser, options, i, function (column) {\n        columns.push(column);\n        i++;\n        next(done);\n      });\n    }\n\n    next(function () {\n      callback(new _token.ColMetadataToken(columns));\n    });\n  });\n}\n\nvar _default = colMetadataParser;\nexports.default = _default;\nmodule.exports = colMetadataParser;","map":null,"metadata":{},"sourceType":"script"}