{"ast":null,"code":"\"use strict\";\n\nObject.defineProperty(exports, \"__esModule\", {\n  value: true\n});\nexports.doneParser = doneParser;\nexports.doneInProcParser = doneInProcParser;\nexports.doneProcParser = doneProcParser;\n\nvar _jsbi = _interopRequireDefault(require(\"jsbi\"));\n\nvar _token = require(\"./token\");\n\nfunction _interopRequireDefault(obj) {\n  return obj && obj.__esModule ? obj : {\n    default: obj\n  };\n} // s2.2.7.5/6/7\n\n\nvar STATUS = {\n  MORE: 0x0001,\n  ERROR: 0x0002,\n  // This bit is not yet in use by SQL Server, so is not exposed in the returned token\n  INXACT: 0x0004,\n  COUNT: 0x0010,\n  ATTN: 0x0020,\n  SRVERROR: 0x0100\n};\n\nfunction parseToken(parser, options, callback) {\n  parser.readUInt16LE(function (status) {\n    var more = !!(status & STATUS.MORE);\n    var sqlError = !!(status & STATUS.ERROR);\n    var rowCountValid = !!(status & STATUS.COUNT);\n    var attention = !!(status & STATUS.ATTN);\n    var serverError = !!(status & STATUS.SRVERROR);\n    parser.readUInt16LE(function (curCmd) {\n      var next = function next(rowCount) {\n        callback({\n          more: more,\n          sqlError: sqlError,\n          attention: attention,\n          serverError: serverError,\n          rowCount: rowCountValid ? rowCount : undefined,\n          curCmd: curCmd\n        });\n      };\n\n      if (options.tdsVersion < '7_2') {\n        parser.readUInt32LE(next);\n      } else {\n        parser.readBigUInt64LE(function (rowCount) {\n          next(_jsbi.default.toNumber(rowCount));\n        });\n      }\n    });\n  });\n}\n\nfunction doneParser(parser, _colMetadata, options, callback) {\n  parseToken(parser, options, function (data) {\n    callback(new _token.DoneToken(data));\n  });\n}\n\nfunction doneInProcParser(parser, _colMetadata, options, callback) {\n  parseToken(parser, options, function (data) {\n    callback(new _token.DoneInProcToken(data));\n  });\n}\n\nfunction doneProcParser(parser, _colMetadata, options, callback) {\n  parseToken(parser, options, function (data) {\n    callback(new _token.DoneProcToken(data));\n  });\n}","map":null,"metadata":{},"sourceType":"script"}