{"ast":null,"code":"\"use strict\";\n\nvar _classCallCheck = require(\"C:\\\\Users\\\\vothb\\\\Desktop\\\\School\\\\Quarter_5\\\\CIS259\\\\Plankcooking-microservices\\\\Plankcooking\\\\client\\\\node_modules\\\\babel-preset-react-app\\\\node_modules\\\\@babel\\\\runtime/helpers/classCallCheck\");\n\nvar _createClass = require(\"C:\\\\Users\\\\vothb\\\\Desktop\\\\School\\\\Quarter_5\\\\CIS259\\\\Plankcooking-microservices\\\\Plankcooking\\\\client\\\\node_modules\\\\babel-preset-react-app\\\\node_modules\\\\@babel\\\\runtime/helpers/createClass\");\n\nObject.defineProperty(exports, \"__esModule\", {\n  value: true\n});\nexports.default = void 0;\n\nvar _writableTrackingBuffer = _interopRequireDefault(require(\"./tracking-buffer/writable-tracking-buffer\"));\n\nvar crypto = _interopRequireWildcard(require(\"crypto\"));\n\nvar _jsbi = _interopRequireDefault(require(\"jsbi\"));\n\nfunction _getRequireWildcardCache() {\n  if (typeof WeakMap !== \"function\") return null;\n  var cache = new WeakMap();\n\n  _getRequireWildcardCache = function _getRequireWildcardCache() {\n    return cache;\n  };\n\n  return cache;\n}\n\nfunction _interopRequireWildcard(obj) {\n  if (obj && obj.__esModule) {\n    return obj;\n  }\n\n  if (obj === null || typeof obj !== \"object\" && typeof obj !== \"function\") {\n    return {\n      default: obj\n    };\n  }\n\n  var cache = _getRequireWildcardCache();\n\n  if (cache && cache.has(obj)) {\n    return cache.get(obj);\n  }\n\n  var newObj = {};\n  var hasPropertyDescriptor = Object.defineProperty && Object.getOwnPropertyDescriptor;\n\n  for (var key in obj) {\n    if (Object.prototype.hasOwnProperty.call(obj, key)) {\n      var desc = hasPropertyDescriptor ? Object.getOwnPropertyDescriptor(obj, key) : null;\n\n      if (desc && (desc.get || desc.set)) {\n        Object.defineProperty(newObj, key, desc);\n      } else {\n        newObj[key] = obj[key];\n      }\n    }\n  }\n\n  newObj.default = obj;\n\n  if (cache) {\n    cache.set(obj, newObj);\n  }\n\n  return newObj;\n}\n\nfunction _interopRequireDefault(obj) {\n  return obj && obj.__esModule ? obj : {\n    default: obj\n  };\n}\n\nvar NTLMResponsePayload = /*#__PURE__*/function () {\n  function NTLMResponsePayload(loginData) {\n    _classCallCheck(this, NTLMResponsePayload);\n\n    this.data = void 0;\n    this.data = this.createResponse(loginData);\n  }\n\n  _createClass(NTLMResponsePayload, [{\n    key: \"toString\",\n    value: function toString() {\n      var indent = arguments.length > 0 && arguments[0] !== undefined ? arguments[0] : '';\n      return indent + 'NTLM Auth';\n    }\n  }, {\n    key: \"createResponse\",\n    value: function createResponse(challenge) {\n      var client_nonce = this.createClientNonce();\n      var lmv2len = 24;\n      var ntlmv2len = 16;\n      var domain = challenge.domain;\n      var username = challenge.userName;\n      var password = challenge.password;\n      var ntlmData = challenge.ntlmpacket;\n      var server_data = ntlmData.target;\n      var server_nonce = ntlmData.nonce;\n      var bufferLength = 64 + domain.length * 2 + username.length * 2 + lmv2len + ntlmv2len + 8 + 8 + 8 + 4 + server_data.length + 4;\n      var data = new _writableTrackingBuffer.default(bufferLength);\n      data.position = 0;\n      data.writeString(\"NTLMSSP\\0\", 'utf8');\n      data.writeUInt32LE(0x03);\n      var baseIdx = 64;\n      var dnIdx = baseIdx;\n      var unIdx = dnIdx + domain.length * 2;\n      var l2Idx = unIdx + username.length * 2;\n      var ntIdx = l2Idx + lmv2len;\n      data.writeUInt16LE(lmv2len);\n      data.writeUInt16LE(lmv2len);\n      data.writeUInt32LE(l2Idx);\n      data.writeUInt16LE(ntlmv2len);\n      data.writeUInt16LE(ntlmv2len);\n      data.writeUInt32LE(ntIdx);\n      data.writeUInt16LE(domain.length * 2);\n      data.writeUInt16LE(domain.length * 2);\n      data.writeUInt32LE(dnIdx);\n      data.writeUInt16LE(username.length * 2);\n      data.writeUInt16LE(username.length * 2);\n      data.writeUInt32LE(unIdx);\n      data.writeUInt16LE(0);\n      data.writeUInt16LE(0);\n      data.writeUInt32LE(baseIdx);\n      data.writeUInt16LE(0);\n      data.writeUInt16LE(0);\n      data.writeUInt32LE(baseIdx);\n      data.writeUInt16LE(0x8201);\n      data.writeUInt16LE(0x08);\n      data.writeString(domain, 'ucs2');\n      data.writeString(username, 'ucs2');\n      var lmv2Data = this.lmv2Response(domain, username, password, server_nonce, client_nonce);\n      data.copyFrom(lmv2Data);\n      var genTime = new Date().getTime();\n      var ntlmDataBuffer = this.ntlmv2Response(domain, username, password, server_nonce, server_data, client_nonce, genTime);\n      data.copyFrom(ntlmDataBuffer);\n      data.writeUInt32LE(0x0101);\n      data.writeUInt32LE(0x0000);\n      var timestamp = this.createTimestamp(genTime);\n      data.copyFrom(timestamp);\n      data.copyFrom(client_nonce);\n      data.writeUInt32LE(0x0000);\n      data.copyFrom(server_data);\n      data.writeUInt32LE(0x0000);\n      return data.data;\n    }\n  }, {\n    key: \"createClientNonce\",\n    value: function createClientNonce() {\n      var client_nonce = Buffer.alloc(8, 0);\n      var nidx = 0;\n\n      while (nidx < 8) {\n        client_nonce.writeUInt8(Math.ceil(Math.random() * 255), nidx);\n        nidx++;\n      }\n\n      return client_nonce;\n    }\n  }, {\n    key: \"ntlmv2Response\",\n    value: function ntlmv2Response(domain, user, password, serverNonce, targetInfo, clientNonce, mytime) {\n      var timestamp = this.createTimestamp(mytime);\n      var hash = this.ntv2Hash(domain, user, password);\n      var dataLength = 40 + targetInfo.length;\n      var data = Buffer.alloc(dataLength, 0);\n      serverNonce.copy(data, 0, 0, 8);\n      data.writeUInt32LE(0x101, 8);\n      data.writeUInt32LE(0x0, 12);\n      timestamp.copy(data, 16, 0, 8);\n      clientNonce.copy(data, 24, 0, 8);\n      data.writeUInt32LE(0x0, 32);\n      targetInfo.copy(data, 36, 0, targetInfo.length);\n      data.writeUInt32LE(0x0, 36 + targetInfo.length);\n      return this.hmacMD5(data, hash);\n    }\n  }, {\n    key: \"createTimestamp\",\n    value: function createTimestamp(time) {\n      var tenthsOfAMicrosecond = _jsbi.default.multiply(_jsbi.default.add(_jsbi.default.BigInt(time), _jsbi.default.BigInt(11644473600)), _jsbi.default.BigInt(10000000));\n\n      var lo = _jsbi.default.toNumber(_jsbi.default.bitwiseAnd(tenthsOfAMicrosecond, _jsbi.default.BigInt(0xffffffff)));\n\n      var hi = _jsbi.default.toNumber(_jsbi.default.bitwiseAnd(_jsbi.default.signedRightShift(tenthsOfAMicrosecond, _jsbi.default.BigInt(32)), _jsbi.default.BigInt(0xffffffff)));\n\n      var result = Buffer.alloc(8);\n      result.writeUInt32LE(lo, 0);\n      result.writeUInt32LE(hi, 4);\n      return result;\n    }\n  }, {\n    key: \"lmv2Response\",\n    value: function lmv2Response(domain, user, password, serverNonce, clientNonce) {\n      var hash = this.ntv2Hash(domain, user, password);\n      var data = Buffer.alloc(serverNonce.length + clientNonce.length, 0);\n      serverNonce.copy(data);\n      clientNonce.copy(data, serverNonce.length, 0, clientNonce.length);\n      var newhash = this.hmacMD5(data, hash);\n      var response = Buffer.alloc(newhash.length + clientNonce.length, 0);\n      newhash.copy(response);\n      clientNonce.copy(response, newhash.length, 0, clientNonce.length);\n      return response;\n    }\n  }, {\n    key: \"ntv2Hash\",\n    value: function ntv2Hash(domain, user, password) {\n      var hash = this.ntHash(password);\n      var identity = Buffer.from(user.toUpperCase() + domain.toUpperCase(), 'ucs2');\n      return this.hmacMD5(identity, hash);\n    }\n  }, {\n    key: \"ntHash\",\n    value: function ntHash(text) {\n      var unicodeString = Buffer.from(text, 'ucs2');\n      return crypto.createHash('md4').update(unicodeString).digest();\n    }\n  }, {\n    key: \"hmacMD5\",\n    value: function hmacMD5(data, key) {\n      return crypto.createHmac('MD5', key).update(data).digest();\n    }\n  }]);\n\n  return NTLMResponsePayload;\n}();\n\nvar _default = NTLMResponsePayload;\nexports.default = _default;\nmodule.exports = NTLMResponsePayload;","map":null,"metadata":{},"sourceType":"script"}